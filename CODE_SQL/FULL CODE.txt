DROP TABLE IMDB_YEAR;
CREATE TABLE IMDB_YEAR(
  YEAR INT,
  RATING FLOAT,
  VOTES INT
  );
  
INSERT INTO IMDB_YEAR
SELECT I.YEAR, SUM(I.RATING), SUM(I.VOTES) FROM imdb_movie_info AS I GROUP BY I.YEAR HAVING COUNT(I.YEAR) > 100;

DROP TABLE INFLUENCE;
CREATE TABLE IF NOT EXISTS INFLUENCE(
  NO INT,
  TITLE STRING,
  YEAR INT,
  INFLUENCE FLOAT,
  GENRE STRING,
  DIRECTORS STRING,
  STARS STRING,
  SCENARIO STRING,
  GROSS STRING,
  CERTIFICATE STRING
);

INSERT INTO INFLUENCE
SELECT INFO.NO, INFO.TITLE, INFO.YEAR, (INFO.RATING/Y.RATING + INFO.VOTES/Y.VOTES), INFO.GENRE, INFO.DIRECTORS, INFO.STARS, INFO.SCENARIO, INFO.GROSS, INFO.CERTIFICATE
FROM imdb_movie_info AS INFO JOIN IMDB_YEAR Y ON INFO.year = Y.YEAR;

CREATE TABLE GENRE(
  GENRE STRING,
  INFLUENCE FLOAT
);

INSERT INTO GENRE
SELECT ITEM, INFLUENCE FROM INFLUENCE LATERAL VIEW EXPLODE(SPLIT(GENRE,',')) T AS ITEM;

CREATE TABLE DIRECTORS(
  DIRECTOR STRING,
  INFLUENCE FLOAT
);

INSERT INTO DIRECTORS
SELECT ITEM, INFLUENCE FROM INFLUENCE LATERAL VIEW EXPLODE(SPLIT(DIRECTORS,',')) T AS ITEM;

CREATE TABLE STARS(
  STAR STRING,
  INFLUENCE FLOAT
);

INSERT INTO STARS
SELECT ITEM, INFLUENCE FROM INFLUENCE LATERAL VIEW EXPLODE(SPLIT(STARS,',')) T AS ITEM;

CREATE TABLE SCENARIO(
  SCENARIO STRING,
  INFLUENCE FLOAT
);

INSERT INTO SCENARIO
SELECT ITEM, INFLUENCE FROM INFLUENCE LATERAL VIEW EXPLODE(SPLIT(SCENARIO,' ')) T AS ITEM;

CREATE TABLE CERTIFICATE(
  CERTIFICATE STRING,
  INFLUENCE FLOAT
);

INSERT INTO CERTIFICATE
SELECT ITEM, INFLUENCE FROM INFLUENCE LATERAL VIEW EXPLODE(SPLIT(CERTIFICATE,' ')) T AS ITEM;

DROP TABLE IMDB_DIRECTOR;
CREATE TABLE IMDB_DIRECTOR(
  DIRECTOR STRING,
  INFLUENCE FLOAT
  );
INSERT INTO IMDB_DIRECTOR
SELECT DIRECTOR, SUM(INFLUENCE) FROM DIRECTORS GROUP BY DIRECTOR;

DROP TABLE IMDB_GENRE;
CREATE TABLE IMDB_GENRE(
  GENRE STRING,
  INFLUENCE FLOAT
  );
INSERT INTO IMDB_GENRE
SELECT GENRE, SUM(INFLUENCE) FROM GENRE GROUP BY GENRE;

DROP TABLE IMDB_STAR;
CREATE TABLE IMDB_STAR(
  STAR STRING,
  INFLUENCE FLOAT
  );
INSERT INTO IMDB_STAR
SELECT STAR, SUM(INFLUENCE) FROM STARS GROUP BY STAR;

DROP TABLE IMDB_SCENARIO;
CREATE TABLE IMDB_SCENARIO(
  SCENARIO STRING,
  INFLUENCE FLOAT
  );
INSERT INTO IMDB_SCENARIO
SELECT SCENARIO, SUM(INFLUENCE) FROM SCENARIO GROUP BY SCENARIO;

DROP TABLE IMDB_CERTIFICATE;
CREATE TABLE IMDB_CERTIFICATE(
  CERTIFICATE STRING,
  INFLUENCE FLOAT
  );
INSERT INTO IMDB_CERTIFICATE
SELECT CERTIFICATE, SUM(INFLUENCE) FROM CERTIFICATE GROUP BY CERTIFICATE;
